```{r child_gene_sets, context="server"}
output$gene_sets <- renderDT({
	options(warn=0)

	eid2 <- ieid2()
	cs2 <- ics2()

	if(eid2==""){
	    validate(
	      	need(eid2!="","Please choose an essential gene and a cluster size (default:small).\nGenes in the cluster will be shown here.")
		)
	}else{
		this.mem <- paste0("mem",match(cs2,cs))
		this.cl <- (df.0 %>% filter(eid==eid2))[[this.mem]]
		if(is.na(this.cl)||this.cl == "NA"){
			eids <- eid2
		}else{
			eids <- df.0[df.0[[this.mem]] %in% this.cl,"eid"]
		}

		dt <- df.0 %>% filter(eid %in% eids) %>%
			select(sym,eid,efficacy, selectivity,mem1,mem2,mem3) %>% 
			arrange(efficacy,desc(selectivity)) %>%
			mutate(sym = paste0('<a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene=',sym,'" target="_blank">',sym,'</a>')) %>%
			`colnames<-`(c("Gene","eid","Eff","Sel","S","M","L"))#,"Clstr","Lik"))

		# warning(paste(dim(dt),collapse=","))
		dt <- dt %>%
			mutate(selected = as.numeric(eid == eid2)) %>%
			mutate(S=sapply(S,function(i){
				if(is.na(i)||i=="NA"){
					return("none")
				}else{
		      	shinyInput(actionButton, i, 'button_', 
			      	label = i,
			      	onclick = 'Shiny.onInputChange(\"c1_button\",  this.id)' )
				}
			})) %>%
			mutate(M=sapply(M,function(i){
				if(is.na(i)||i=="NA"){
					return("none")
				}else{
		      	shinyInput(actionButton, i, 'button_', 
			      	label = i,
			      	onclick = 'Shiny.onInputChange(\"c2_button\",  this.id)' )
				}
			})) %>%
			mutate(L=sapply(L,function(i){
				if(is.na(i)||i=="NA"){
					return("none")
				}else{
		      	shinyInput(actionButton, i, 'button_', 
			      	label = i,
			      	onclick = 'Shiny.onInputChange(\"c3_button\",  this.id)' )
				}
			})) %>%
			datatable(extensions = 'Scroller', 
				options = list(
				  columnDefs = list(
				  	list(targets = c(2,8), visible = FALSE),
				  	list(className = 'dt-center', targets = 1:7)
				  	),
	　　			  rowReorder = TRUE,
				  deferRender = TRUE,
				  scrollY = 1000,
				  pageLength = 200,
				  scroller = TRUE,
				  order = list(list(3, 'asc'), list(4, 'desc'))),
				selection=list(mode="none"),
				editable=FALSE, escape=FALSE) %>%
 		    formatStyle(
			  8,
			  target = 'row',
			  backgroundColor = styleEqual(c(1,0), c('#ffcccb', NA))
			)
		return(dt)
	}
})

# dataTableProxy for quicker update
```
```{r}
DTOutput("gene_sets")
```
